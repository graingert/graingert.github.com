<?php
session_start();
    if(isset($_POST['username']) && $_POST['password']){
        $username = $_POST['username'];
        $password = $_POST['password'];

        $user = 'comp2040'; 
        $pswd = 'BRT5ybuvByRmMS96'; 
        $db = 'comp2040';
        $conn = mysql_connect('localhost', $user, $pswd);
        mysql_select_db($db, $conn);
        
        $query = "SELECT * FROM users WHERE user_name = '$username' AND password = 
PASSWORD('$password')";
        
        $result = mysql_query($query) or die("Unable to verify user because : " . 
mysql_error());


        if(mysql_num_rows($result) == 1){
            //Store the result using php session.
            $_SESSION = mysql_fetch_assoc($result);
        } else {
            $err = "Username and/or Password incorrect";
        }
    }
if(isset($_POST['logout'])) {
    //Delete the session information
    session_destroy();
    $_SESSION = array();
}
?>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
    </head>
    <body>
        <form action="" method="post">
            <?php if(isset($_SESSION['user_name'])){
                echo "<p>" . $_SESSION['user_name'] . " is logged in</p>" ?>
                <input type="submit" name="logout" value="Logout"/>
            <?php } else { 
                if(isset($err)) { 
                    echo "<p>$err</p>";
                }?>
                <p>
                    <label for="username">username:</label>
                    <input id="username" name="username" size="13" />
                </p>
                <p>
                    <label for="password">password:</label>
                    <input id="password" type="password" name="password" size="13" /></p>
                <input type="submit" name="login" value="Login" />
            <?php } ?>
        </form>
    </body>
</html>

