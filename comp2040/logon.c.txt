#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

// gcc -o  logon logon.c -fno-stack-protector -z execstack -mpreferred-stack-boundary=2 -ggdb

int checkIdent(char *login, char *pwd)
{
    char buffer[8] = {'\0'};
    int i;   //?

    strcpy(buffer, login);
    buffer[strlen("admin1")] = '\0';

    if(strcmp(buffer, "admin1"))
        return 0;

    strcpy(buffer, pwd);
    buffer[strlen("admin1")] = '\0';

    if(strcmp(buffer, "admin1"))
        return 0;

    return 1;
}
void printSecretStuff(){
    execl("/bin/cat", "/bin/cat", "/etc/shadow", (char *) 0);
   
    //execv("/bin/cat", args);

        //printf("Secret admin stuff here!!\n");
    return;
}
int main(int argc, char *argv[])
{
    printf("************PSS - Pottses Secure Systems*************\n");
    printf("Admin login utility\n");
    printf("*****************************************************\n\n");

    if (argc == 1){
        printf("Incorrect usage. \nTry: ./logon username password\n");
        exit(-1);
    }
    
    if(checkIdent(argv[1], argv[2])) {
        printSecretStuff();
        exit(1);
    }

    printf("Bad username or password\n");
    return 0;
}

